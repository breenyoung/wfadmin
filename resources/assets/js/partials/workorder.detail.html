<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Work Order Details</title>
</head>
<body>

<form name="ctrlWorkOrderDetail.form1" novalidate>

<p class="md-headline">
    Work Order #{{ctrlWorkOrderDetail.workorder.id}}
    <span class="md-caption" ng-show="ctrlWorkOrderDetail.workorder.purchase_order_id">
        (<a class="md-primary nounderline" ui-sref="app.purchaseorders.detail({purchaseOrderId: ctrlWorkOrderDetail.workorder.purchase_order_id})">Generated by PO #{{ctrlWorkOrderDetail.workorder.purchase_order_id}}</a>)
    </span>
</p>

<md-input-container>
    <label>Customer</label>
    <md-select name="customer_id" ng-model="ctrlWorkOrderDetail.workorder.customer_id" required>
        <md-option ng-repeat="c in ctrlWorkOrderDetail.customers" value="{{c.id}}">
            {{c.first_name}} {{c.last_name}}
        </md-option>
    </md-select>

    <div ng-messages="ctrlWorkOrderDetail.form1.customer_id.$error" role="alert" ng-show="ctrlWorkOrderDetail.form1.customer_id.$touched || ctrlWorkOrderDetail.form1.$submitted">
        <div ng-messages-include="error-messages"></div>
    </div>

</md-input-container>
<br/>
<md-input-container>
    <label>Product</label>

    <md-select name="product_id" ng-model="ctrlWorkOrderDetail.workorder.product_id" required>
        <md-option ng-repeat="p in ctrlWorkOrderDetail.products" value="{{p.id}}">
            {{p.name}}
        </md-option>
    </md-select>

    <div ng-messages="ctrlWorkOrderDetail.form1.product_id.$error" role="alert" ng-show="ctrlWorkOrderDetail.form1.product_id.$touched || ctrlWorkOrderDetail.form1.$submitted">
        <div ng-messages-include="error-messages"></div>
    </div>

</md-input-container>
<br/>

<div layout="row">
    <div flex>
        <md-input-container class="md-block" flex-gt-sm>
            <label>Quantity</label>
            <input type="text" name="quantity" ng-model="ctrlWorkOrderDetail.workorder.quantity" required ng-pattern="ctrlWorkOrderDetail.numericRegex"/>

            <div ng-messages="ctrlWorkOrderDetail.form1.quantity.$error" role="alert" ng-show="ctrlWorkOrderDetail.form1.quantity.$touched || ctrlWorkOrderDetail.form1.$submitted">
                <div class="errorMessage" ng-message="pattern">This field must be a number</div>
                <div ng-messages-include="error-messages"></div>
            </div>

        </md-input-container>
    </div>
</div>


<md-datepicker name="startdate" ng-model="ctrlWorkOrderDetail.workorder.start_date" md-placeholder="Start Date" utc-Parser required></md-datepicker>
<div ng-messages="ctrlWorkOrderCreate.form1.startdate.$error" role="alert" ng-show="ctrlWorkOrderCreate.form1.startdate.$touched || ctrlWorkOrderCreate.form1.$submitted">
    <div ng-messages-include="error-messages"></div>
</div>

<md-datepicker name="enddate" ng-model="ctrlWorkOrderDetail.workorder.end_date" md-placeholder="End Date" utc-Parser required></md-datepicker>
<div ng-messages="ctrlWorkOrderDetail.form1.enddate.$error" role="alert" ng-show="ctrlWorkOrderDetail.form1.enddate.$touched || ctrlWorkOrderDetail.form1.$submitted">
    <div ng-messages-include="error-messages"></div>
</div>

<md-switch class="md-primary" ng-true-value="1" ng-false-value="0" ng-model="ctrlWorkOrderDetail.workorder.completed"  aria-label="Completed">
    Completed:
</md-switch>

<md-input-container class="md-block" flex-gt-sm>
    <label>Notes</label>
    <textarea ng-model="ctrlWorkOrderDetail.workorder.notes"></textarea>
</md-input-container>

<div layout="row" ng-show="ctrlWorkOrderDetail.workorder.image_filename !== null">
    <md-button aria-label="View Current Image" ng-click="ctrlWorkOrderDetail.viewAttachment($event, ctrlWorkOrderDetail.workorder.image_filename)"><ng-md-icon icon="camera_alt"></ng-md-icon>&nbsp;View Current Image</md-button>
    <md-button aria-label="Delete Current Image" ng-click="ctrlWorkOrderDetail.deleteAttachment($event, ctrlWorkOrderDetail.workorder.image_filename)"><ng-md-icon icon="delete"></ng-md-icon>&nbsp;Delete Current Image</md-button>
</div>

<div layout="row" ng-show="ctrlWorkOrderDetail.workorder.image_filename === null">
    <button type="file" ngf-select="ctrlWorkOrderDetail.uploadFile($file, $invalidFiles)" accept="image/*" ngf-max-size="2MB">Select File</button>
    <div style="font-size: smaller;">{{ctrlWorkOrderDetail.f.name}} {{ctrlWorkOrderDetail.errFile.name}} {{ctrlWorkOrderDetail.errFile.$error}} {{ctrlWorkOrderDetail.errFile.$errorParam}}
<span class="progress" ng-show="ctrlWorkOrderDetail.f.progress >= 0">
    <div style="width:{{ctrlWorkOrderDetail.f.progress}}%" ng-bind="ctrlWorkOrderDetail.f.progress + '%'"></div>
</span>
    </div>
    <br/>
</div>


<div layout="row" layout-xs="column">
    <div flex layout="column">
        <md-button class="md-raised md-primary" ng-click="ctrlWorkOrderDetail.updateWorkOrder()">Submit</md-button>
    </div>
    <div flex layout="column">
        <md-button class="md-raised md-warn" ng-click="ctrlWorkOrderDetail.showDeleteConfirm()">Delete</md-button>
    </div>
    <div flex layout="column">
        <md-button class="md-raised" ui-sref="app.workorders">Cancel</md-button>
    </div>
</div>

</form>

</body>
</html>